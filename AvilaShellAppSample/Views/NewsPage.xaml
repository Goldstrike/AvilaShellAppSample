<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AvilaShellAppSample.Views.NewsPage"
             xmlns:vm="clr-namespace:AvilaShellAppSample.ViewModels"
             xmlns:ctrl="clr-namespace:AvilaShellAppSample.Controls"
             xmlns:model="clr-namespace:AvilaShellAppSample.Models"
             xmlns:sfCards="clr-namespace:Syncfusion.XForms.Cards;assembly=Syncfusion.Cards.XForms"
             xmlns:sfRotator="clr-namespace:Syncfusion.SfRotator.XForms;assembly=Syncfusion.SfRotator.XForms"
             xmlns:sfBorder="clr-namespace:Syncfusion.XForms.Border;assembly=Syncfusion.Core.XForms"
             Title="{Binding Title}">
    <ContentPage.BindingContext>
        <vm:NewsViewModel />
    </ContentPage.BindingContext>
    <ContentPage.Content>
        <RefreshView x:DataType="vm:NewsViewModel" 
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}">
            <ScrollView>
                <StackLayout Padding="0" Spacing="8">

                    <!-- Events -->
                    <!-- Events Header label  -->
                    <!--                          -->
                    <Label
                        FontFamily="MontserratSemiBold"
                        FontSize="12"
                        LineHeight="{OnPlatform Default=-1,
                                                Android=1.25}"
                        Text="AGENDA"
                        Margin="8"/>
                    <!-- Events List -->
                    <sfRotator:SfRotator
                        x:Name="EventsList"
                        BackgroundColor="Transparent"
                        DotsBorderColor="Transparent" 
                        UnselectedDotColor="{DynamicResource Gray-200}"
                        SelectedDotColor="{DynamicResource ApricotAvilaColor}" 
                        DotPlacement="OutSide"
                        HeightRequest="295"
                        HorizontalOptions="StartAndExpand"
                        ItemsSource="{Binding Events}"
                        NavigationDirection="Horizontal"
                        NavigationStripMode="Dots"
                        VerticalOptions="Start"
                        Margin="8, 0">
                    <sfRotator:SfRotator.ItemTemplate>
                        <DataTemplate>
                            <StackLayout x:DataType="model:Event" Spacing="0">
                                <ctrl:CustomShadowFrame x:Name="Rotator" BackgroundColor="{DynamicResource Gray-White}" 
                                                        BorderColor="{DynamicResource Gray-White}" BorderWidth="1" 
                                                        CornerRadius="4" HasShadow="True" Margin="4" Padding="0">
                                    <Grid RowSpacing="0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Image of the event -->
                                        <Image Aspect="AspectFill"
                                               BackgroundColor="{DynamicResource Gray-White}"
                                               HeightRequest="195">
                                            <Image.Source>
                                                <UriImageSource CacheValidity="14"
                                                                CachingEnabled="true" 
                                                                Uri="{Binding Image}" />
                                            </Image.Source>
                                        </Image>

                                        <Grid Grid.Row="1"
                                              Padding="8,12" ColumnSpacing="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Date of the event -->
                                            <sfBorder:SfBorder  CornerRadius="6" Margin="0" HasShadow="False" BorderColor="Transparent"
                                                                WidthRequest="40" HeightRequest="40"
                                                                BackgroundColor="{StaticResource ApricotAvilaColor}">
                                                <sfBorder:SfBorder.Content>
                                                    <Grid>
                                                        <StackLayout  Spacing="0" Margin="0,4,0,0">
                                                            <!--  Event month label  -->
                                                            <Label Text="{Binding StartDate, StringFormat= '{}{0:MMM}'}" TextColor="{StaticResource Gray-White}" 
                                                                   FontSize="12"  FontFamily="MontserratSemiBold" 
                                                                   HorizontalOptions="Center" />
                                                            <!--  Event event label  -->
                                                            <Label Text="{Binding StartDate, StringFormat= '{}{0:dd}'}"  TextColor="{StaticResource Gray-White}" 
                                                                   FontSize="12"  FontFamily="MontserratSemiBold" 
                                                                   HorizontalOptions="Center" />
                                                        </StackLayout>
                                                    </Grid>
                                                </sfBorder:SfBorder.Content>
                                            </sfBorder:SfBorder>

                                            
                                            <StackLayout Margin="8,0,0,0" Grid.Column="1" Spacing="4" >

                                                <!--  Event name   -->
                                                <Label Text="{Binding Name}"
                                                       FontSize="16" FontFamily="MontserratSemiBold" TextColor="{DynamicResource Gray-900}"
                                                       HorizontalOptions="Start" 
                                                       MaxLines="1" LineBreakMode="TailTruncation"/>

                                                <!--  Event location -->
                                                <Label Text="{Binding Address.Name}"
                                                       FontSize="12" FontFamily="MontserratMedium" TextColor="{DynamicResource Gray-700}"
                                                       HorizontalOptions="Start" 
                                                       MaxLines="1" LineBreakMode="TailTruncation"/>

                                            </StackLayout>
                                        </Grid>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding BindingContext.OpenEventCommand,Source={x:Reference EventsList}}"
                                                                  CommandParameter="{Binding .}"/>
                                        </Grid.GestureRecognizers>
                                    </Grid>
                                </ctrl:CustomShadowFrame>
                            </StackLayout>
                        </DataTemplate>
                    </sfRotator:SfRotator.ItemTemplate>
                </sfRotator:SfRotator>

                    <!-- News -->
                    <!-- Events Header label  -->
                    <Label
                        FontFamily="MontserratSemiBold"
                        FontSize="12"
                        LineHeight="{OnPlatform Default=-1,
                                                Android=1.25}"
                        Text="ACTUALITES"
                        Margin="8"/>
                    <!-- News List-->
                    <StackLayout x:Name="NewsList"
                                 BindableLayout.ItemsSource="{Binding News}"
                                 Spacing="16"
                                 Margin="8,0">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <!--
                                <ctrl:CustomShadowFrame x:Name="Rotator" BackgroundColor="{DynamicResource Gray-White}" 
                                                        BorderColor="{DynamicResource Gray-White}" BorderWidth="1" 
                                                        CornerRadius="4" HasShadow="True" Margin="4" Padding="0">-->
                                <ctrl:ShadowFrame
                                    IsClippedToBounds="True">
                                    <StackLayout x:DataType="model:News">
                                        <Grid Padding="0"
                                              VerticalOptions="FillAndExpand"
                                              HorizontalOptions="FillAndExpand">
                                            <Image Source="{Binding Image}"
                                                   Aspect="AspectFill"/>
                                        </Grid>
                                        <Label Text="{Binding Description}"
                                               FontSize="16" FontFamily="MontserratSemiBold" TextColor="{DynamicResource Gray-900}"
                                               Margin="8,8,8,0" />
                                        <Label Text="{Binding Date, StringFormat= '{}{0:dd/MM/yyyy}'}"
                                               FontSize="12" FontFamily="MontserratMedium" TextColor="{DynamicResource Gray-700}"
                                               Margin="8,0,8,4" />
                                        <StackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding BindingContext.OpenNewsCommand,Source={x:Reference NewsList}}"
                                                                    CommandParameter="{Binding .}"/>
                                        </StackLayout.GestureRecognizers>
                                    </StackLayout>
                                    </ctrl:ShadowFrame>
                               <!--</ctrl:CustomShadowFrame>-->
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </StackLayout>

                </StackLayout>
            </ScrollView>
        </RefreshView>
    </ContentPage.Content>
</ContentPage>